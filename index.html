<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <title>Awareness Alert PWA for David</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="white">  
  <meta name="apple-mobile-web-app-capable" content="yes">  
  <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
  <meta name="apple-mobile-web-app-title" content="Hello World"> 
  <meta name="msapplication-TileImage" content="images/hello-icon-144.png">  
  <meta name="msapplication-TileColor" content="#FFFFFF">
  
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon.ico" type="image/x-icon">  
  <link rel="apple-touch-icon" href="images/hello-icon-152.png">   
  
  <script>
    /*window.onload = () => {
      'use strict';
    
      if('serviceWorker' in navigator)
      {
        navigator.serviceWorker.register('sw.js', { scope: '/' })
        .then(function (registration)
        {
          console.log('Service worker registered successfully');
          console.log("hello");
          window.addEventListener("deviceorientation", handleOrientation, true);
          
                
        }).catch(function (e)
        {
          console.error('Error during service worker registration:', e);
        });
      }
    }*/
    
    function get_permissions()
    {
      if(navigator.geolocation)
      {
        console.log('ok')
        navigator.geolocation.getCurrentPosition(handleGeolocation, null);
      }
      else
      {
        console.log('Geolocation is not supported by this device')
      }
      /*Geolocation.requestPermission().then(response => {
        if (response == 'granted')
        {
            console.log("geoloc permission ok");
        }
      });*/
      
      DeviceMotionEvent.requestPermission().then(response => {
        if (response == 'granted')
        {
            console.log("accelerometer permission ok");
            window.addEventListener("devicemotion", handleMotion, true);
        }
      });
    }
    
    function handleGeolocation(position)
    {
      let latitude  = position.coords.latitude;
      let longitude = position.coords.longitude;
      
      document.getElementById("secondary").innerHTML=   latitude.toFixed(2) + "<br>"
                                                      + longitude.toFixed(2) + "<br>"
    }
    
    function handleMotion(event)
    {
      let x = event.acceleration.x;
      let y = event.acceleration.y;
      let z = event.acceleration.z;
      
      document.getElementById("main").innerHTML=  x.toFixed(2) + "<br>"
                                                + y.toFixed(2) + "<br>"
                                                + z.toFixed(2) + "<br>";
                                                
      navigator.geolocation.getCurrentPosition(handleGeolocation, null);
    }
  </script>
  
  <style>
   body
   {
    font-family: sans-serif;
   }
   
   html, .fullscreen
   {
    display: flex;
    height: 100%;
    margin: 0;
    padding: 0;
    width: 100%;
   }
   
   .container
   {
    margin: auto;
    text-align: center;
   }
   
   .title
   {
    font-size: 3rem;
   }
  </style>
</head>
<body class="fullscreen">
  <div class="container">
    <h1 id="main" class="title">Hello World!</h1>
    <h1 id="secondary" class="title">Hello World!</h1>
    <button id="accelPermsButton"  style="font-size: 2rem;height:100px;" onclick="get_permissions()"><h1>Get Accelerometer and Geolocation Permissions</h1></button>
  </div>
</body>
</html>